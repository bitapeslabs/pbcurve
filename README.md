# pbcurve

## Build & publish

The npm package ships both the TypeScript wrapper (`dist`) and the wasm-bindgen
artifacts generated by `wasm-pack` (`native/pkg` for Node, `native/pkg-web` for browsers).

- Run `npm run build` to produce **all** outputs locally (node wasm, web wasm, TS builds).  
- `npm pack`/`npm publish` trigger the same build through the `prepack` script, ensuring the JS glue + `.wasm` blobs are always included in the tarball.  
- Verify the contents with `npm pack --dry-run` after a build.

## Usage

### Node / SSR (CommonJS or ESM)

```ts
import { Curve } from "pbcurve/node"; // or `const { Curve } = require("pbcurve");`

const cfg = {
  total_supply: 1_000_000n * 10n ** 8n,
  sell_amount: 500_000n * 10n ** 8n,
  vt: 250_000n * 10n ** 8n,
  mc_target_sats: 10_000_000n * 10n ** 8n,
};

const curve = (await Curve.create(cfg)).expect("curve init failed");
const price = curve.snapshot(0n).expect("snapshot").x;
```

### Browser / Edge runtimes

```ts
import { initWebCurveWasm, Curve } from "pbcurve/web";

await initWebCurveWasm(); // optional: pass your own fetch/URL/Response

const cfg = {
  total_supply: 1_000_000n * 10n ** 8n,
  sell_amount: 500_000n * 10n ** 8n,
  vt: 250_000n * 10n ** 8n,
  mc_target_sats: 10_000_000n * 10n ** 8n,
};

const curve = (await Curve.create(cfg)).expect("curve init failed");
const quote = curve.quoteInGivenAssetOut(0n, 1_000n * 10n ** 8n).expect("quote");
```

`initWebCurveWasm` accepts anything `wasm-pack`â€™s loader does (URL, `Request`, `Response`, or an ArrayBuffer/Module), so you can hook it into your bundler/asset pipeline easily. Subsequent `Curve.create` calls reuse the initialized module automatically.
